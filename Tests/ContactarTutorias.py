import pywhatkit
from datetime import datetime
import time
import pyautogui
import keyboard as k
import os
from dotenv import load_dotenv
from shareplum import Site
from shareplum import Office365
import locale

load_dotenv()
locale.setlocale(locale.LC_TIME, "es_ES.UTF-8")

userSh = os.getenv("SHAREPOINT_USER")
passSh = os.getenv("SHAREPOINT_PASS")
auxPhone = os.getenv("AUX_PHONE")

# Autenticaci√≥n en SharePoint
authcookie = Office365(
    "https://unitechn.sharepoint.com", username=userSh, password=passSh
).GetCookies()
site = Site(
    "https://unitechn.sharepoint.com/sites/TutoriasUNITEC2/", authcookie=authcookie
)

# Listas de SharePoint
sp_list_Tutorias = site.List("Tutorias")
sp_list_Tutores = site.List("Tutores")
sp_list_Aulas = site.List("Aulas")

# Obtener datos de las listas
Tutoriasdata = sp_list_Tutorias.GetListItems(
    fields=[
        "ID",
        "Aula",
        "Tipo de Tutoria",
        "Contactado",
        "Estado",
        "Telefono",
        "Nombre Tutor",
        "Tipo de Tutoria",
        "Fecha de Tutoria",
        "Hora Tutoria",
        "Clases",
        "Temas",
        "Alumnos",
        "Aula",
        "Numero de Cuenta",
        "HoraClasica",
        "ClaseClasica",
    ]
)
Tutoresdata = sp_list_Tutores.GetListItems(
    fields=["ID", "Tutor", "Telefono", "TelefonoAuxiliar", "N√∫mero de Cuenta"]
)
Aulasdata = sp_list_Aulas.GetListItems(fields=["ID", "IdAula ", "Oficial"])
contactados = {
"ContactarPendientes": False,
"ContactarCoordinadas": False,
"ContactarRechazadas": False,
"ContactarReagendadas": False,
"ContactarCanceladas": False,
"ContactarModeradorAula": False,
"ContactarSinTutor": False
}

FilteredTutoriasdata = Tutoriasdata
size = len(FilteredTutoriasdata)


def obtenerNumerCuentaTutor(tutor):
    for j in range(0, len(Tutoresdata)):
        if Tutoresdata[j]["Tutor"] == tutor:
            return Tutoresdata[j]["N√∫mero de Cuenta"]
    return "00000000"


def autoGuiSkip():
    pyautogui.click(800, 450)
    time.sleep(2)
    k.press_and_release("enter")
    time.sleep(2)


def contactarPendientes():
    for i in range(0, size):
        if (
            FilteredTutoriasdata[i]["Estado"]
            and FilteredTutoriasdata[i]["Estado"] == "Pendiente"
            and FilteredTutoriasdata[i]["Contactado"] == "No"
        ):
            TelefonoTutor = ""
            TelefonoAlumno = ""
            for j in range(0, len(Tutoresdata)):
                if Tutoresdata[j]["Tutor"] == FilteredTutoriasdata[i]["Nombre Tutor"]:
                    try:
                        TelefonoTutor = Tutoresdata[j]["Telefono"]
                        TelefonoAlumno = FilteredTutoriasdata[i]["Telefono"]
                    except:
                        try:
                            TelefonoTutor = Tutoresdata[j]["TelefonoAuxiliar"]
                        except:
                            TelefonoTutor = auxPhone

            numAux = "+504" + TelefonoTutor
            clase = None
            if "Clases" in FilteredTutoriasdata[i]:
                clase = FilteredTutoriasdata[i]["Clases"]
            else:
                clase = FilteredTutoriasdata[i]["ClaseClasica"]
            hora = None
            if "Hora Tutoria" in FilteredTutoriasdata[i]:
                hora = FilteredTutoriasdata[i]["Hora Tutoria"]
            else:
                hora = FilteredTutoriasdata[i]["HoraClasica"]

            mensaje = "‚ú®üêØPROPUESTA de TutoriaüêØ‚ú®"
            mensaje += "\n\n‚û°Ô∏è Modalidad : " + FilteredTutoriasdata[i]["Tipo de Tutoria"]
            mensaje += "\n‚û°Ô∏è Fecha: " + FilteredTutoriasdata[i][
                "Fecha de Tutoria"
            ].strftime("%Y-%m-%d %H:%M:%S")
            mensaje += (
                "\n‚û°Ô∏è D√≠a: "
                + FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%A").upper()
            )
            mensaje += "\n‚û°Ô∏è Hora: " + hora
            mensaje += "\n‚û°Ô∏è Asignatura: " + clase
            mensaje += "\n‚û°Ô∏è Alumno: " + FilteredTutoriasdata[i]["Alumnos"]
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoAlumno
            mensaje += "\n‚û°Ô∏è Tema: " + FilteredTutoriasdata[i]["Temas"]
            mensaje += "\n‚û°Ô∏è Tutor: " + FilteredTutoriasdata[i]["Nombre Tutor"]
            mensaje += "\n\nAprobada Responder con => üëç"
            mensaje += "\nRechazada Responder con => üëé"
            mensaje += "\n\n(Si confirmas por medio de este mensaje, no es necesario que respondas el correo)"
            mensaje += "\n\nVer Mis Tutorias: https://heylink.me/josue546/"

            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 25, True, 4)
            print("Mensaje enviado a: ", numAux)
            update_data = [{"ID": FilteredTutoriasdata[i]["ID"], "Contactado": "Yes"}]
            sp_list_Tutorias.UpdateListItems(data=update_data, kind="Update")
            contactados["ContactarPendientes"] = True


def contactarCoordinadas():
    for i in range(0, size):
        now = datetime.now()
        now = now.replace(hour=0, minute=0, second=0, microsecond=0)
        fecha_str = FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%Y-%m-%d")
        fecha = datetime.strptime(fecha_str, "%Y-%m-%d")

        if (
            FilteredTutoriasdata[i]["Estado"] == "Coordinada"
            and FilteredTutoriasdata[i]["Contactado"] == "No"
            and FilteredTutoriasdata[i]["Fecha de Tutoria"] >= now
            and FilteredTutoriasdata[i]["Temas"] != "PAE"
        ):
            clase = None
            if "Clases" in FilteredTutoriasdata[i]:
                clase = FilteredTutoriasdata[i]["Clases"]
            else:
                clase = FilteredTutoriasdata[i]["ClaseClasica"]
            hora = None
            if "Hora Tutoria" in FilteredTutoriasdata[i]:
                hora = FilteredTutoriasdata[i]["Hora Tutoria"]
            else:
                hora = FilteredTutoriasdata[i]["HoraClasica"]
            if (
                FilteredTutoriasdata[i]["Nombre Tutor"]
                == "CARDENAS DELCID CYNTHIA STEPHANIE"
                and FilteredTutoriasdata[i]["Fecha de Tutoria"] != now
            ):
                # Si es Cynthia y no es el dia de la tutoria se omite
                continue

            TelefonoTutor = ""
            TelefonoAlumno = ""
            for j in range(0, len(Tutoresdata)):
                if Tutoresdata[j]["Tutor"] == FilteredTutoriasdata[i]["Nombre Tutor"]:
                    try:
                        TelefonoTutor = Tutoresdata[j]["Telefono"]
                    except:
                        TelefonoTutor = auxPhone
                    try:
                        TelefonoAlumno = FilteredTutoriasdata[i]["Telefono"]
                    except:
                        TelefonoAlumno = auxPhone

            numAux = "+504" + TelefonoTutor
            print("Mensaje enviado a: ", numAux)
            AulaTutoria = "Zoom"
            NombreTutor = FilteredTutoriasdata[i]["Nombre Tutor"]

            if FilteredTutoriasdata[i]["Tipo de Tutoria"] == "Presencial":
                AulaTutoria = FilteredTutoriasdata[i]["Aula"]

            mensaje = "‚úÖ‚úÖ‚úÖüêØRECORDATORIO de TutoriaüêØ‚úÖ‚úÖ‚úÖ"
            mensaje += "\n\n‚û°Ô∏è Modalidad : " + FilteredTutoriasdata[i]["Tipo de Tutoria"]
            mensaje += "\n‚û°Ô∏è Fecha: " + FilteredTutoriasdata[i][
                "Fecha de Tutoria"
            ].strftime("%Y-%m-%d %H:%M:%S")
            mensaje += (
                "\n‚û°Ô∏è D√≠a: "
                + FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%A").upper()
            )
            mensaje += "\n‚û°Ô∏è Hora: " + hora
            mensaje += "\n‚û°Ô∏è Asignatura: " + clase
            mensaje += "\n‚û°Ô∏è Alumno: " + FilteredTutoriasdata[i]["Alumnos"]
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoAlumno
            mensaje += "\n‚û°Ô∏è Tema: " + FilteredTutoriasdata[i]["Temas"]
            mensaje += "\n‚û°Ô∏è Tutor: " + NombreTutor
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoTutor
            mensaje += "\n‚û°Ô∏è Aula: " + AulaTutoria
            mensaje += "\n\n‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ"
            mensaje += "\n\nVer Mis Tutorias: https://heylink.me/josue546/"

            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 25, False, 4)

            autoGuiSkip()
            numAux = "+504" + TelefonoAlumno
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 15, False, 4)
            update_data = [{"ID": FilteredTutoriasdata[i]["ID"], "Contactado": "Yes"}]
            sp_list_Tutorias.UpdateListItems(data=update_data, kind="Update")

        if (
            FilteredTutoriasdata[i]["Temas"] == "PAE"
            and FilteredTutoriasdata[i]["Contactado"] == "No"
            and fecha == now
        ):
            TelefonoTutor = ""
            TelefonoAlumno = ""
            for j in range(0, len(Tutoresdata)):
                if Tutoresdata[j]["Tutor"] == FilteredTutoriasdata[i]["Nombre Tutor"]:
                    try:
                        TelefonoTutor = Tutoresdata[j]["Telefono"]
                    except:
                        TelefonoTutor = auxPhone
                    try:
                        TelefonoAlumno = FilteredTutoriasdata[i]["Telefono"]
                    except:
                        TelefonoAlumno = auxPhone

            numAux = "+504" + TelefonoTutor
            print("Mensaje enviado a: ", numAux)
            AulaTutoria = "Zoom"
            NombreTutor = FilteredTutoriasdata[i]["Nombre Tutor"]

            if FilteredTutoriasdata[i]["Tipo de Tutoria"] == "Presencial":
                try:
                    AulaTutoria = FilteredTutoriasdata[i]["Aula"]
                except:
                    AulaTutoria = "Zoom"

            mensaje = "‚úÖ‚úÖ‚úÖüêØRECORDATORIO de TutoriaüêØ‚úÖ‚úÖ‚úÖ"
            mensaje += "\n\n‚û°Ô∏è Modalidad : " + FilteredTutoriasdata[i]["Tipo de Tutoria"]
            mensaje += "\n‚û°Ô∏è Fecha: " + FilteredTutoriasdata[i][
                "Fecha de Tutoria"
            ].strftime("%Y-%m-%d %H:%M:%S")
            mensaje += (
                "\n‚û°Ô∏è D√≠a: "
                + FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%A").upper()
            )
            mensaje += "\n‚û°Ô∏è Hora: " + FilteredTutoriasdata[i]["Hora Tutoria"]
            mensaje += "\n‚û°Ô∏è Asignatura: " + FilteredTutoriasdata[i]["Clases"]
            mensaje += "\n‚û°Ô∏è Alumno: " + FilteredTutoriasdata[i]["Alumnos"]
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoAlumno
            mensaje += "\n‚û°Ô∏è Tema: " + FilteredTutoriasdata[i]["Temas"]
            mensaje += "\n‚û°Ô∏è Tutor: " + NombreTutor
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoTutor
            mensaje += "\n‚û°Ô∏è Aula: " + AulaTutoria
            mensaje += "\n\n‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ‚úÖ"
            mensaje += "\n\nVer Mis Tutorias: https://heylink.me/josue546/"

            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 25, False, 4)
            print("Mensaje enviado a: ", numAux)

            numAux = "+504" + TelefonoAlumno
            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 15, False, 4)
            print("Mensaje enviado a: ", numAux)
            update_data = [{"ID": FilteredTutoriasdata[i]["ID"], "Contactado": "Yes"}]
            sp_list_Tutorias.UpdateListItems(data=update_data, kind="Update")
            contactados["ContactarCoordinadas"] = True


def contactarRechazadas():
    now = datetime.now()
    for i in range(0, size):
        if (
            (FilteredTutoriasdata[i]["Estado"] == "Rechazada")
            and FilteredTutoriasdata[i]["Contactado"] == "No"
            and FilteredTutoriasdata[i]["Fecha de Tutoria"] < now
        ):
            clase = None
            if "Clases" in FilteredTutoriasdata[i]:
                clase = FilteredTutoriasdata[i]["Clases"]
            else:
                clase = FilteredTutoriasdata[i]["ClaseClasica"]
            hora = None
            if "Hora Tutoria" in FilteredTutoriasdata[i]:
                hora = FilteredTutoriasdata[i]["Hora Tutoria"]
            else:
                hora = FilteredTutoriasdata[i]["HoraClasica"]

            TelefonoAlumno = ""
            for j in range(0, len(Tutoresdata)):
                if Tutoresdata[j]["Tutor"] == FilteredTutoriasdata[i]["Nombre Tutor"]:
                    TelefonoAlumno = FilteredTutoriasdata[i]["Telefono"]

            numAux = "+504" + TelefonoAlumno
            mensaje = "üêØTutorias UnitecüêØ"
            mensaje += "\n\nSaludos de Tutorias Unitec, espero que se encuentre bien. Le escribo por la tutoria que habia solicitado, la cual no pudimos agendar con un tutor a tiempo por falta de disponibilidad. Si desea reagendar o cancelar la tutoria, por favor responder a este mensaje."
            mensaje += "\n\n‚û°Ô∏è Modalidad : " + FilteredTutoriasdata[i]["Tipo de Tutoria"]
            mensaje += "\n‚û°Ô∏è Fecha: " + FilteredTutoriasdata[i][
                "Fecha de Tutoria"
            ].strftime("%Y-%m-%d %H:%M:%S")
            mensaje += (
                "\n‚û°Ô∏è D√≠a: "
                + FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%A").upper()
            )
            mensaje += "\n‚û°Ô∏è Hora: " + hora
            mensaje += "\n‚û°Ô∏è Asignatura: " + clase
            mensaje += "\n‚û°Ô∏è Alumno: " + FilteredTutoriasdata[i]["Alumnos"]
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoAlumno
            mensaje += "\n‚û°Ô∏è Tema: " + FilteredTutoriasdata[i]["Temas"]
            mensaje += "\n‚û°Ô∏è Tutor: " + FilteredTutoriasdata[i]["Nombre Tutor"]
            mensaje += "\n\nDesea reagendar para esta semana => üëç"
            mensaje += "\nPrefiere ya no recibir la tutoria => üëé"
            mensaje += "\nTambien puedes responder a este mensaje con que otro horario en otro dia podrias recibir la tutoria"

            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 25, False, 4)
            print("Mensaje enviado a: ", numAux)
            update_data = [
                {
                    "ID": FilteredTutoriasdata[i]["ID"],
                    "Contactado": "Yes",
                    "Estado": "No se impartio",
                }
            ]
            sp_list_Tutorias.UpdateListItems(data=update_data, kind="Update")
            contactados["ContactarRechazadas"] = True


def contactarModeradorAula():
    for i in range(0, size):
        if (
            FilteredTutoriasdata[i]["Estado"] == "CASO"
            and FilteredTutoriasdata[i]["Contactado"] == "No"
        ):
            TelefonoAlumno = ""
            for j in range(0, len(Tutoresdata)):
                if Tutoresdata[j]["Tutor"] == FilteredTutoriasdata[i]["Nombre Tutor"]:
                    TelefonoAlumno = FilteredTutoriasdata[i]["Telefono"]

            numAux = "+504" + TelefonoAlumno
            clase = None
            if "Clases" in FilteredTutoriasdata[i]:
                clase = FilteredTutoriasdata[i]["Clases"]
            else:
                clase = FilteredTutoriasdata[i]["ClaseClasica"]
            hora = None
            if "Hora Tutoria" in FilteredTutoriasdata[i]:
                hora = FilteredTutoriasdata[i]["Hora Tutoria"]
            else:
                hora = FilteredTutoriasdata[i]["HoraClasica"]

            mensaje = "‚ú®üêØSolicitud de AULA de Tutorias UnitecüêØ‚ú®"
            mensaje += "\n\n‚û°Ô∏è Modalidad : " + FilteredTutoriasdata[i]["Tipo de Tutoria"]
            mensaje += "\n‚û°Ô∏è Fecha: " + FilteredTutoriasdata[i][
                "Fecha de Tutoria"
            ].strftime("%Y-%m-%d %H:%M:%S")
            mensaje += "\n‚û°Ô∏è Hora: " + hora
            mensaje += "\n‚û°Ô∏è Asignatura: " + clase
            mensaje += "\n‚û°Ô∏è Alumno: " + FilteredTutoriasdata[i]["Alumnos"]
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoAlumno
            mensaje += "\n‚û°Ô∏è Tema: " + FilteredTutoriasdata[i]["Temas"]
            mensaje += "\n‚û°Ô∏è Tutor: " + FilteredTutoriasdata[i]["Nombre Tutor"]

            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly("+50489886363", mensaje, 25, False, 4)
            print("Mensaje enviado a: ", numAux)
            update_data = [{"ID": FilteredTutoriasdata[i]["ID"], "Contactado": "Yes"}]
            sp_list_Tutorias.UpdateListItems(data=update_data, kind="Update")
            contactados["ContactarCoordinadas"] = True


def contactarReagendadas():
    for i in range(0, size):
        now = datetime.now()
        now = now.replace(hour=0, minute=0, second=0, microsecond=0)
        fecha_str = FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%Y-%m-%d")
        fecha = datetime.strptime(fecha_str, "%Y-%m-%d")

        if (
            FilteredTutoriasdata[i]["Estado"] == "Reagendar"
            and FilteredTutoriasdata[i]["Contactado"] == "No"
            and FilteredTutoriasdata[i]["Fecha de Tutoria"] >= now
            and FilteredTutoriasdata[i]["Temas"] != "PAE"
        ):
            if (
                FilteredTutoriasdata[i]["Nombre Tutor"]
                == "CARDENAS DELCID CYNTHIA STEPHANIE"
                and FilteredTutoriasdata[i]["Fecha de Tutoria"] != now
            ):
                # Si es Cynthia y no es el dia de la tutoria se omite
                continue

            TelefonoTutor = ""
            TelefonoAlumno = ""
            for j in range(0, len(Tutoresdata)):
                if Tutoresdata[j]["Tutor"] == FilteredTutoriasdata[i]["Nombre Tutor"]:
                    try:
                        TelefonoTutor = Tutoresdata[j]["Telefono"]
                    except:
                        TelefonoTutor = auxPhone
                    try:
                        TelefonoAlumno = FilteredTutoriasdata[i]["Telefono"]
                    except:
                        TelefonoAlumno = auxPhone

            numAux = "+504" + TelefonoTutor
            AulaTutoria = "Zoom"
            NombreTutor = FilteredTutoriasdata[i]["Nombre Tutor"]

            if FilteredTutoriasdata[i]["Tipo de Tutoria"] == "Presencial":
                AulaTutoria = FilteredTutoriasdata[i]["Aula"]

            clase = None
            if "Clases" in FilteredTutoriasdata[i]:
                clase = FilteredTutoriasdata[i]["Clases"]
            else:
                clase = FilteredTutoriasdata[i]["ClaseClasica"]
            hora = None
            if "Hora Tutoria" in FilteredTutoriasdata[i]:
                hora = FilteredTutoriasdata[i]["Hora Tutoria"]
            else:
                hora = FilteredTutoriasdata[i]["HoraClasica"]

            mensaje = "üìÖüîÑ *Solicitud de Reagendamiento de Tutor√≠a* üîÑüìÖ"
            mensaje += "\n\n‚û°Ô∏è Modalidad: " + FilteredTutoriasdata[i]["Tipo de Tutoria"]
            mensaje += "\n‚û°Ô∏è Fecha: " + FilteredTutoriasdata[i][
                "Fecha de Tutoria"
            ].strftime("%Y-%m-%d %H:%M:%S")
            mensaje += (
                "\n‚û°Ô∏è D√≠a: "
                + FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%A").upper()
            )
            mensaje += "\n‚û°Ô∏è Hora: " + hora
            mensaje += "\n‚û°Ô∏è Asignatura: " + clase
            mensaje += "\n‚û°Ô∏è Alumno: " + FilteredTutoriasdata[i]["Alumnos"]
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoAlumno
            mensaje += "\n‚û°Ô∏è Tema: " + FilteredTutoriasdata[i]["Temas"]
            mensaje += "\n‚û°Ô∏è Tutor: " + NombreTutor
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoTutor
            mensaje += "\n‚û°Ô∏è Aula: " + AulaTutoria
            mensaje += "\n\n‚ö†Ô∏è ¬øConfirmas reagendar la tutor√≠a? ‚ö†Ô∏è"
            mensaje += "\n\n‚úÖ Aprobada: Responder con => üëç"
            mensaje += "\n‚ùå Rechazada: Responder con => üëé"
            mensaje += "\n\nüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑüîÑ"
            mensaje += "\n\nüìå Ver Mis Tutor√≠as: https://heylink.me/josue546/"

            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 25, False, 4)
            print("Mensaje enviado a: ", numAux)

            numAux = "+504" + TelefonoAlumno
            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 15, False, 4)
            print("Mensaje enviado a: ", numAux)
            update_data = [{"ID": FilteredTutoriasdata[i]["ID"], "Contactado": "Yes"}]
            sp_list_Tutorias.UpdateListItems(data=update_data, kind="Update")
            contactados["ContactarReagendadas"] = True


def contactarSinTutor():
    for i in range(0, size):
        if (
            FilteredTutoriasdata[i]["Estado"] == "Sin Tutor"
            and FilteredTutoriasdata[i]["Contactado"] == "No"
        ):
            TelefonoAlumno = ""
            TelefonoAlumno = FilteredTutoriasdata[i]["Telefono"]
            numAux = "+504" + TelefonoAlumno
            clase = None
            if "Clases" in FilteredTutoriasdata[i]:
                clase = FilteredTutoriasdata[i]["Clases"]
            else:
                clase = FilteredTutoriasdata[i]["ClaseClasica"]
            hora = None
            if "Hora Tutoria" in FilteredTutoriasdata[i]:
                hora = FilteredTutoriasdata[i]["Hora Tutoria"]
            else:
                hora = FilteredTutoriasdata[i]["HoraClasica"]

            mensaje = "üêØTutorias UnitecüêØ \nüìïüìïüìïüìïüìïüìïüìïüìïüìïüìïüìïüìïüìïüìï"
            mensaje += "\n\nEsperamos que est√©s bien. Quer√≠amos informarte que, lamentablemente, *no pudimos coordinar tu solicitud de tutor√≠a porque no hab√≠a disponibilidad para ese d√≠a u horario üìÖ.* Esto sucede debido a la alta demanda de tutor√≠as."
            mensaje += "\n\n‚û°Ô∏è Modalidad : " + FilteredTutoriasdata[i]["Tipo de Tutoria"]
            mensaje += "\n‚û°Ô∏è Fecha: " + FilteredTutoriasdata[i][
                "Fecha de Tutoria"
            ].strftime("%Y-%m-%d %H:%M:%S")
            mensaje += (
                "\n‚û°Ô∏è D√≠a: "
                + FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%A").upper()
            )
            mensaje += "\n‚û°Ô∏è Hora: " + hora
            mensaje += "\n‚û°Ô∏è Asignatura: " + clase
            mensaje += "\n‚û°Ô∏è Alumno: " + FilteredTutoriasdata[i]["Alumnos"]
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoAlumno
            mensaje += "\n‚û°Ô∏è Tema: " + FilteredTutoriasdata[i]["Temas"]
            mensaje += "\n\nTe sugerimos intentar solicitar nuevamente üîÑ y revisar el cat√°logo de tutores en @tutorias_unitecsps en Instagram üì≤, donde puedes ver la oferta disponible. ¬°Esperamos poder ayudarte pronto! ‚ú®"
            mensaje += "\nTambien puedes responder a este mensaje con que otro horario en otro dia podrias recibir la tutoria\nüìïüìïüìïüìïüìïüìïüìïüìïüìïüìïüìïüìïüìïüìï"

            autoGuiSkip()
            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 25, False, 4)
            print("Mensaje enviado a: ", numAux)
            update_data = [
                {
                    "ID": FilteredTutoriasdata[i]["ID"],
                    "Contactado": "Yes",
                    "Estado": "No se impartio",
                }
            ]
            sp_list_Tutorias.UpdateListItems(data=update_data, kind="Update")
            contactados["ContactarReagendadas"] = True


def contactarCanceladas():
    now = datetime.now()
    for i in range(0, size):
        if (
            (FilteredTutoriasdata[i]["Estado"] == "Cancelada")
            and FilteredTutoriasdata[i]["Contactado"] == "No"
            and FilteredTutoriasdata[i]["Fecha de Tutoria"] < now
        ):
            TelefonoAlumno = ""
            for j in range(0, len(Tutoresdata)):
                if Tutoresdata[j]["Tutor"] == FilteredTutoriasdata[i]["Nombre Tutor"]:
                    TelefonoAlumno = FilteredTutoriasdata[i]["Telefono"]
            
            numAux = "+504" + TelefonoAlumno
            clase = None
            if "Clases" in FilteredTutoriasdata[i]:
                clase = FilteredTutoriasdata[i]["Clases"]
            else:
                clase = FilteredTutoriasdata[i]["ClaseClasica"]
            hora = None
            if "Hora Tutoria" in FilteredTutoriasdata[i]:
                hora = FilteredTutoriasdata[i]["Hora Tutoria"]
            else:
                hora = FilteredTutoriasdata[i]["HoraClasica"]

            mensaje = "üêØTutorias UnitecüêØ"
            mensaje += "\n\nSaludos de Tutorias Unitec, espero que se encuentre bien. Le escribo por la tutoria que habia solicitado, ."
            mensaje += "\n\n‚û°Ô∏è Modalidad : " + FilteredTutoriasdata[i]["Tipo de Tutoria"]
            mensaje += "\n‚û°Ô∏è Fecha: " + FilteredTutoriasdata[i][
                "Fecha de Tutoria"
            ].strftime("%Y-%m-%d %H:%M:%S")
            mensaje += (
                "\n‚û°Ô∏è D√≠a: "
                + FilteredTutoriasdata[i]["Fecha de Tutoria"].strftime("%A").upper()
            )
            mensaje += "\n‚û°Ô∏è Hora: " + hora
            mensaje += "\n‚û°Ô∏è Asignatura: " + clase
            mensaje += "\n‚û°Ô∏è Alumno: " + FilteredTutoriasdata[i]["Alumnos"]
            mensaje += "\n‚û°Ô∏è Contacto: " + TelefonoAlumno
            mensaje += "\n‚û°Ô∏è Tema: " + FilteredTutoriasdata[i]["Temas"]
            mensaje += "\n‚û°Ô∏è Tutor: " + FilteredTutoriasdata[i]["Nombre Tutor"]
            mensaje += "\n\nDesea reagendar para esta semana => üëç"
            mensaje += "\nPrefiere ya no recibir la tutoria => üëé"
            mensaje += "\nTambien puedes responder a este mensaje con que otro horario en otro dia podrias recibir la tutoria"

            pywhatkit.sendwhatmsg_instantly(numAux, mensaje, 25, False, 4)
            print("Mensaje enviado a: ", numAux)
            autoGuiSkip()
            update_data = [
                {
                    "ID": FilteredTutoriasdata[i]["ID"],
                    "Contactado": "Yes",
                    "Estado": "No se impartio",
                }
            ]
            sp_list_Tutorias.UpdateListItems(data=update_data, kind="Update")
            contactados["ContactarCanceladas"] = True


def menuContactar():
    while True:
        print("\nüêØ Men√∫ de Contacto de Tutor√≠as üêØ")
        print("1. Contactar Tutorias Pendientes")
        print("2. Contactar Tutorias Coordinadas")
        print("3. Contactar Tutorias Rechazadas")
        print("4. Contactar Moderador de Aula")
        print("5. Contactar Tutorias Reagendadas")
        print("6. Contactar Tutorias Sin Tutor")
        print("7. Contactar Tutorias Canceladas")
        print("8. Salir")

        opcion = input("Seleccione una opci√≥n: ")
        if opcion == "1":
            if contactados["ContactarPendientes"]:
                print("Ya se han contactado las tutorias pendientes.")
                return
            print("Contactando Tutorias Pendientes...")
            contactarPendientes()
        elif opcion == "2":
            if contactados["ContactarCoordinadas"]:
                print("Ya se han contactado las tutorias coordinadas.")
                return
            print("Contactando Tutorias Coordinadas...")
            contactarCoordinadas()
        elif opcion == "3":
            if contactados["ContactarRechazadas"]:
                print("Ya se han contactado las tutorias rechazadas.")
                return
            print("Contactando Tutorias Rechazadas...")
            contactarRechazadas()
        elif opcion == "4":
            if contactados["ContactarReagendadas"]:
                print("Ya se han contactado las tutorias reagendadas.")
                return
            print("Contactando Tutorias Reagendadas...")
            contactarReagendadas()
        elif opcion == "5":
            if contactados["ContactarModeradorAula"]:
                print("Ya se ha contactado al moderador de aula.")
                return
            print("Contactando Moderador de Aula...")
            contactarModeradorAula()
        elif opcion == "6":
            if contactados["ContactarSinTutor"]:
                print("Ya se han contactado las tutorias sin tutor.")
                return
            print("Contactando Moderador Tutor...")
            contactarSinTutor()
        elif opcion == "7":
            if contactados["ContactarCanceladas"]:
                print("Ya se han contactado las tutorias canceladas.")
                return
            print("Contactando Tutorias Canceladas...")
            contactarCanceladas()
        elif opcion == "8":
            print("üêØ Saliendo del programa üêØ")
            break
        else:
            print("Opci√≥n no v√°lida. Intente nuevamente.")


menuContactar()
